
# Here I will be explaining Structure and how to work with Next.js

Great question. This project is using Next.js‚Äô ‚Äúpages‚Äù router (pre‚ÄìApp Router) rather than the newer ‚Äúapp‚Äù directory with RootLayout. That‚Äôs why you don‚Äôt see an app/RootLayout.tsx or layout.tsx file.

How it works here

Routing: It uses the pages/ directory. Each file under pages/ corresponds to a route. For dynamic Notion pages, there‚Äôs typically a catch‚Äëall route (e.g., pages/[slug].tsx or similar) that fetches Notion content and renders it via the NotionRenderer.

Layout: Instead of a single RootLayout, layout concerns are handled directly inside page components and shared components:

# Head/meta/SEO: components/PageHead.tsx sets meta tags, Open Graph/Twitter tags, RSS, and structured data for blog posts.
# How does the process of RSS feed work :

1. at starter the project at build time compiles your Notion pages into an RSS XML String 
2. fetches all notion pages through a pre defined function 
3. Map each post to an RSS item with title , link (canonical URL) then serilaized the channel + items to XML

Then the ins of how to write code for RSS feed is by using rss.ts library and checking the documents
--------------------------------------------------------------------------------------------------------------------------------------------


# Header/nav: components/NotionPageHeader.tsx renders breadcrumb navigation and optional nav links based on config.

1. it uses navigation links from congif lib and filter them based on pageId and index
2. if not the page will not be rendered 
3. also something that might be a good highlight part of SSR compatability by using hasMounted check to avoid hydration mismatch between client and server side

------------------------------------------------------------------------------------------------------

# Aside/actions: components/PageAside.tsx conditionally renders social actions or comments, especially on blog posts.

- pulling out embeded tweet links from within notion pages 

------------------------------------------------------------------------------------------------------


# Footer: components/Footer.tsx is memoized and passed into the renderer.

# Global body classes: react-body-classname is used in NotionPage to attach classes like notion-lite and dark-mode to the body.

----------------------------------------------------------------------------------------------------------------

# Page composition: components/NotionPage.tsx is effectively the ‚Äúroot page layout‚Äù for Notion content. It:

Configures NotionRenderer (react-notion-x) with dynamic third-party components (Code, Collection, Equation, Pdf, Modal, Tweet).

Computes SEO data (title, description, social image) and renders PageHead at the top.

Sets flags like showTableOfContents, previewImages, and passes mapPageUrl/mapImageUrl functions and searchNotion for site-wide behavior.

Supplies pageAside and footer as React nodes to NotionRenderer, which acts like a layout shell.

Handles loading/fallback and 404 via Loading and Page404.

Server vs client config: Global flags like config.isDev and config.isServer control whether canonical URLs are emitted and whether certain globals are exposed for debugging.

Theming: useDarkMode controls darkMode in NotionRenderer and applies a body class. ToggleThemeButton in the header switches themes.

SEO for blog posts: PageHead includes schema.org BlogPosting JSON-LD when isBlogPost is true.

--------------------------------------------------------------------------------

# Why no RootLayout?

RootLayout is part of the Next.js App Router (app/ directory) introduced in Next.js 13. This starter uses the [Pages Router], which centralizes ‚Äúlayout‚Äù behavior in shared components and the top-level NotionPage. That‚Äôs a perfectly valid pattern for pages/.

If you wanted to migrate to App Router

You‚Äôd create app/layout.tsx to host global HTML/body wrappers, meta defaults, ThemeProvider, and shared header/footer.

You‚Äôd place the Notion page rendering logic into app/[...slug]/page.tsx (or similar), and move PageHead logic into either app/layout.tsx using next/head equivalents or Next 13‚Äôs Metadata API.

You‚Äôd still reuse the same components (PageHead logic can be adapted to the Metadata API; NotionRenderer usage stays similar).

In short: NotionPage.tsx plus PageHead/PageAside/NotionPageHeader/Footer act together as the layout for content pages. The Pages Router doesn‚Äôt require a RootLayout file; the ‚Äúlayout‚Äù is composed in the page component and passed into NotionRenderer.

# The Hirerchial Architecture

1. Starts from Notion Page where it imports all components together 
2. like PageHead , PageAside + notion Renderer
3. then each one of these component has its own internal functions


----------------------------------------------------------------------------------------------------------------------------------------------------------


# site.config.ts file - this file is the single place to customize your site




















----------------------------------------------------------------------------------------------------------------------------------------------------------

# Here the General Explanation of the Project and How to Set it Up


<p align="center">
  <a href="https://transitivebullsh.it/nextjs-notion-starter-kit">
    <img alt="Example article page" src="https://user-images.githubusercontent.com/552829/160132094-12875e09-41ec-450a-80fc-ae8cd488129d.jpg" width="689">
  </a>
</p>

# Next.js Notion Starter Kit

> The perfect starter kit for building websites with Next.js and Notion.

[![Build Status](https://github.com/transitive-bullshit/nextjs-notion-starter-kit/actions/workflows/build.yml/badge.svg)](https://github.com/transitive-bullshit/nextjs-notion-starter-kit/actions/workflows/build.yml) [![Prettier Code Formatting](https://img.shields.io/badge/code_style-prettier-brightgreen.svg)](https://prettier.io)

## Intro

This repo is what I use to power my personal blog and portfolio site [transitivebullsh.it](https://transitivebullsh.it).

It uses Notion as a CMS, [react-notion-x](https://github.com/NotionX/react-notion-x), [Next.js](https://nextjs.org/), and [Vercel](https://vercel.com).

## Features

- Setup only takes a few minutes ([single config file](./site.config.ts)) üí™
- Robust support for Notion content via [react-notion-x](https://github.com/NotionX/react-notion-x)
- Built using Next.js, TS, and React
- Excellent page speeds
- Smooth image previews
- Automatic social images
- Automatic pretty URLs
- Automatic table of contents
- Full support for dark mode
- Quick search via CMD+K / CMD+P
- Responsive for different devices
- Optimized for Next.js and Vercel

## Demos

- [Default demo](https://nextjs-notion-starter-kit.transitivebullsh.it) - Deployed from the `main` branch
- [My site](https://transitivebullsh.it) - Deployed from the `transitive-bullshit` branch

## Setup

**All config is defined in [site.config.ts](./site.config.ts).**

This project requires a recent version of Node.js (we recommend >= 16).

1. Fork / clone this repo
2. Change a few values in [site.config.ts](./site.config.ts)
3. `npm install`
4. `npm run dev` to test locally
5. `npm run deploy` to deploy to vercel üí™
6. Double check your [Vercel project settings](#vercel-configuration)

I tried to make configuration as easy as possible ‚Äî All you really need to do to get started is edit `rootNotionPageId`.

We recommend duplicating the [default page](https://notion.so/7875426197cf461698809def95960ebf) as a starting point, but you can use any public notion page you want.

Make sure your root Notion page is **public** and then copy the link to your clipboard. Extract the last part of the URL that looks like `7875426197cf461698809def95960ebf`, which is your page's Notion ID.

In order to find your Notion workspace ID (optional), just load any of your site's pages into your browser and open up the developer console. There will be a global variable that you can access called `block` which is the Notion data for the current page. If you enter `block.space_id`, it will print out your page's workspace ID.

I recommend setting up a collection on your home page that contains all of your articles / projects / content. There are no structural constraints on your Notion workspace, however, so feel free to add content as you normally would in Notion.

### Vercel Configuration

**Social media preview images won't work by default on Vercel**. You'll need to ensure that your site doesn't require auth.

From your Vercel project settings, you'll want to **disable Vercel Authentication** from `Project -> Settings -> Deployment Protection`.

![How to disable Vercel Deployment Protection setting](https://github.com/user-attachments/assets/a1eb5a1f-da7a-497e-b4f6-f7e851a6cd8a 'How to disable Vercel Deployment Protection setting which causes social media preview image endpoint to return 401 Unauthorized')

üí° If you forget to do this your site will return `401 Unauthorized` responses when crawlers are trying to retrieve the images.

## URL Paths

The app defaults to slightly different URL paths in dev vs prod (though pasting any dev pathname into prod will work and vice-versa).

In development, it will use `/nextjs-notion-blog-d1b5dcf8b9ff425b8aef5ce6f0730202` which is a slugified version of the page's title suffixed with its Notion ID. I've found that it's really useful to always have the Notion Page ID front and center during local development.

In production, it will use `/nextjs-notion-blog` which is a bit nicer as it gets rid of the extra ID clutter.

The mapping of Notion ID to slugified page titles is done automatically as part of the build process. Just keep in mind that if you plan on changing page titles over time, you probably want to make sure old links will still work, and we don't currently provide a solution for detecting old links aside from Next.js's built-in [support for redirects](https://nextjs.org/docs/api-reference/next.config.js/redirects).

See [mapPageUrl](./lib/map-page-url.ts) and [getCanonicalPageId](https://github.com/NotionX/react-notion-x/blob/master/packages/notion-utils/src/get-canonical-page-id.ts) for more details.

You can override the default slug generation on a per-page basis by adding a `Slug` text property to your database. Any page which has a `Slug` property will use that as its slug.

NOTE: if you have multiple pages in your workspace with the same slugified name, the app will throw an error letting you know that there are duplicate URL pathnames.

## Preview Images

<p align="center">
  <img alt="Example preview image" src="https://user-images.githubusercontent.com/552829/160142320-35343317-aa9e-4710-bcf7-67e5cdec586d.gif" width="458">
</p>

We use [next/image](https://nextjs.org/docs/api-reference/next/image) to serve images efficiently, with preview images optionally generated via [lqip-modern](https://github.com/transitive-bullshit/lqip-modern). This gives us extremely optimized image support for sexy smooth images.

Preview images are **enabled by default**, but they can be slow to generate, so if you want to disable them, set `isPreviewImageSupportEnabled` to `false` in `site.config.ts`.

### Redis

If you want to cache generated preview images to speed up subsequent builds, you'll need to first set up an external [Redis](https://redis.io) data store. To enable redis caching, set `isRedisEnabled` to `true` in `site.config.ts` and then set `REDIS_HOST` and `REDIS_PASSWORD` environment variables to point to your redis instance.

You can do this locally by adding a `.env` file:

```bash
REDIS_HOST='TODO'
REDIS_PASSWORD='TODO'
```

If you're not sure which Redis provider to use, we recommend [Redis Labs](https://redis.com), which provides a free plan.

Note that preview images and redis caching are both optional features. If you‚Äôd rather not deal with them, just disable them in your site config.

## Styles

All CSS styles that customize Notion content are located in [styles/notion.css](./styles/notion.css). They mainly target global CSS classes exported by react-notion-x [styles.css](https://github.com/NotionX/react-notion-x/blob/master/packages/react-notion-x/src/styles.css).

Every notion block gets its own unique classname, so you can target individual blocks like this:

```css
.notion-block-260baa77f1e1428b97fb14ac99c7c385 {
  display: none;
}
```

## Dark Mode

<p align="center">
  <img alt="Light Mode" src="https://transitive-bs.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F83ea9f0f-4761-4c0b-b53e-1913627975fc%2Ftransitivebullsh.it_-opt.jpg?table=block&id=ed7e8f60-c6d1-449e-840b-5c7762505c44&spaceId=fde5ac74-eea3-4527-8f00-4482710e1af3&width=2000&userId=&cache=v2" width="45%">
&nbsp; &nbsp; &nbsp; &nbsp;
  <img alt="Dark Mode" src="https://transitive-bs.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc0839d6c-7141-48df-8afd-69b27fed84aa%2Ftransitivebullsh.it__(1)-opt.jpg?table=block&id=23b11fe5-d6df-422d-9674-39cf7f547523&spaceId=fde5ac74-eea3-4527-8f00-4482710e1af3&width=2000&userId=&cache=v2" width="45%">
</p>

Dark mode is fully supported and can be toggled via the sun / moon icon in the footer.

## Automatic Social Images

<p align="center">
  <img alt="Example social image" src="https://user-images.githubusercontent.com/552829/162001133-34d4cf24-123a-4569-a540-f683b22830d1.jpeg" width="600">
</p>

All Open Graph and social meta tags are generated from your Notion content, which makes social sharing look professional by default.

Social images are generated automatically using [Vercel OG Image Generation](https://vercel.com/docs/concepts/functions/edge-functions/og-image-generation). You can tweak the default React template for social images by editing [api/social-images.tsx](./pages/api/social-image.tsx).

You can view an example social image live in production [here](https://transitivebullsh.it/api/social-image?id=dfc7f709-ae3e-42c6-9292-f6543d5586f0).

## Automatic Table of Contents

<p align="center">
  <img alt="Smooth ToC Scrollspy" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcb2df62d-9028-440b-964b-117711450921%2Ftoc2.gif?table=block&id=d7e9951b-289c-4ff2-8b82-b0a61fe260b1&cache=v2" width="240">
</p>

By default, every article page will have a table of contents displayed as an `aside` on desktop. It uses **scrollspy** logic to automatically update the current section as the user scrolls through your document, and makes it really easy to jump between different sections.

If a page has less than `minTableOfContentsItems` (default 3), the table of contents will be hidden. It is also hidden on the index page and if the browser window is too small.

This table of contents uses the same logic that Notion uses for its built-in Table of Contents block (see [getPageTableOfContents](https://github.com/NotionX/react-notion-x/blob/master/packages/notion-utils/src/get-page-table-of-contents.ts) for the underlying logic).

## Responsive

<p align="center">
  <img alt="Mobile article page" src="https://user-images.githubusercontent.com/552829/160132983-c2dd5830-80b3-4a0e-a8f1-abab5dbeed11.jpg" width="300">
</p>

All pages are designed to be responsive across common device sizes.

## Analytics

Analytics are an optional feature that are easy to enable if you want.

### Fathom Analytics

[Fathom](https://usefathom.com/ref/42TFOZ) provides a lightweight alternative to Google Analytics.

To enable, just add a `NEXT_PUBLIC_FATHOM_ID` environment variable, which will only be used in production.

### PostHog Analytics

[PostHog](https://posthog.com/) provides a lightweight, **open source** alternative to Google Analytics.

To enable, just add a `NEXT_PUBLIC_POSTHOG_ID` environment variable, which will only be used in production.

## Environment Variables

If you're using Redis, analytics, or any other feature which requires environment variables, then you'll need to [add them to your Vercel project](https://vercel.com/docs/concepts/projects/environment-variables).

If you want to test your redis builds with GitHub Actions, then you'll need to edit the [default build action](./.github/workflows/build.yml) to add `REDIS_HOST` and `REDIS_PASSWORD`. Here is an [example from my personal branch](https://github.com/transitive-bullshit/nextjs-notion-starter-kit/blob/transitive-bullshit/.github/workflows/build.yml#L17-L21). You'll also need to add these environment variables to your GitHub repo as [repository secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets).

## Contributing

See the [contribution guide](contributing.md) and join our amazing list of [contributors](https://github.com/transitive-bullshit/nextjs-notion-starter-kit/graphs/contributors)!

## License

MIT ¬© [Travis Fischer](https://transitivebullsh.it)

Support my open source work by <a href="https://twitter.com/transitive_bs">following me on twitter <img src="https://storage.googleapis.com/saasify-assets/twitter-logo.svg" alt="twitter" height="24px" align="center"></a>
